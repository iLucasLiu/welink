# jitpack.yml
jdk:
  - openjdk17

install:
  # 所有模块使用 Git 标签版本（由JitPack自动决定）
  - VERSION=$(git describe --tags --always | sed 's/^v//')
  
  # kit-release
  - mkdir -p $HOME/.m2/repository/com/github/iLucasLiu/kit-release/$VERSION
  - cp kit-release-1.0.0.aar $HOME/.m2/repository/com/github/iLucasLiu/kit-release/$VERSION/kit-release-$VERSION.aar
  - sed "s/<version>.*<\/version>/<version>$VERSION<\/version>/g" pom-kit-release.xml > $HOME/.m2/repository/com/github/iLucasLiu/kit-release/$VERSION/kit-release-$VERSION.pom

  # welink-main
  - mkdir -p $HOME/.m2/repository/com/github/iLucasLiu/welink-main/$VERSION
  - cp welink-main-5.8.1.aar $HOME/.m2/repository/com/github/iLucasLiu/welink-main/$VERSION/welink-main-$VERSION.aar
  - sed "s/<version>.*<\/version>/<version>$VERSION<\/version>/g" pom-welink-main.xml > $HOME/.m2/repository/com/github/iLucasLiu/welink-main/$VERSION/welink-main-$VERSION.pom

  # welink-appui
  - mkdir -p $HOME/.m2/repository/com/github/iLucasLiu/welink-appui/$VERSION
  - cp welink-appui-1.0.0.aar $HOME/.m2/repository/com/github/iLucasLiu/welink-appui/$VERSION/welink-appui-$VERSION.aar
  - sed "s/<version>.*<\/version>/<version>$VERSION<\/version>/g" pom-welink-appui.xml > $HOME/.m2/repository/com/github/iLucasLiu/welink-appui/$VERSION/welink-appui-$VERSION.pom

  # welink-demoapi
  - mkdir -p $HOME/.m2/repository/com/github/iLucasLiu/welink-demoapi/$VERSION
  - cp welink-demoapi-1.0.0.aar $HOME/.m2/repository/com/github/iLucasLiu/welink-demoapi/$VERSION/welink-demoapi-$VERSION.aar
  - sed "s/<version>.*<\/version>/<version>$VERSION<\/version>/g" pom-welink-demoapi.xml > $HOME/.m2/repository/com/github/iLucasLiu/welink-demoapi/$VERSION/welink-demoapi-$VERSION.pom

  # welink-encoder
  - mkdir -p $HOME/.m2/repository/com/github/iLucasLiu/welink-encoder/$VERSION
  - cp welink-encoder-1.0.0.aar $HOME/.m2/repository/com/github/iLucasLiu/welink-encoder/$VERSION/welink-encoder-$VERSION.aar
  - sed "s/<version>.*<\/version>/<version>$VERSION<\/version>/g" pom-welink-encoder.xml > $HOME/.m2/repository/com/github/iLucasLiu/welink-encoder/$VERSION/welink-encoder-$VERSION.pom

  # welink-queue
  - mkdir -p $HOME/.m2/repository/com/github/iLucasLiu/welink-queue/$VERSION
  - cp welink-queue-1.0.0.aar $HOME/.m2/repository/com/github/iLucasLiu/welink-queue/$VERSION/welink-queue-$VERSION.aar
  - sed "s/<version>.*<\/version>/<version>$VERSION<\/version>/g" pom-welink-queue.xml > $HOME/.m2/repository/com/github/iLucasLiu/welink-queue/$VERSION/welink-queue-$VERSION.pom

  - echo "所有AAR复制完成，版本：$VERSION"

artifacts:
  - $HOME/.m2/repository/com/github/iLucasLiu/kit-release/$VERSION/kit-release-$VERSION.aar
  - $HOME/.m2/repository/com/github/iLucasLiu/welink-main/$VERSION/welink-main-$VERSION.aar
  - $HOME/.m2/repository/com/github/iLucasLiu/welink-appui/$VERSION/welink-appui-$VERSION.aar
  - $HOME/.m2/repository/com/github/iLucasLiu/welink-demoapi/$VERSION/welink-demoapi-$VERSION.aar
  - $HOME/.m2/repository/com/github/iLucasLiu/welink-encoder/$VERSION/welink-encoder-$VERSION.aar
  - $HOME/.m2/repository/com/github/iLucasLiu/welink-queue/$VERSION/welink-queue-$VERSION.aar